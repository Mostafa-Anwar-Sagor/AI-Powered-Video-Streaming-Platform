{% extends 'netflix/admin/base.html' %}

{% block title %}Videos - StreamFlix Content Manager{% endblock %}

{% block content %}
<div class="admin-header">
    <h1 class="admin-title">Video Library</h1>
    <a href="{% url 'netflix:admin_video_add' %}" class="btn btn-primary">‚ûï Add New Video</a>
</div>

<!-- Search and Filters -->
<div class="admin-card">
    <form method="GET" action="{% url 'netflix:admin_video_list' %}" style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
        <div class="form-group" style="flex: 1; min-width: 250px; margin-bottom: 0;">
            <input 
                type="text" 
                name="q" 
                class="form-control" 
                placeholder="Search videos by title, director, or cast..."
                value="{{ request.GET.q }}"
            >
        </div>
        <div class="form-group" style="margin-bottom: 0;">
            <select name="category" class="form-control" style="min-width: 150px;">
                <option value="">All Categories</option>
                {% for category in all_categories %}
                <option value="{{ category.id }}" {% if request.GET.category == category.id|stringformat:"s" %}selected{% endif %}>
                    {{ category.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group" style="margin-bottom: 0;">
            <select name="type" class="form-control" style="min-width: 130px;">
                <option value="">All Types</option>
                <option value="movie" {% if request.GET.type == "movie" %}selected{% endif %}>Movie</option>
                <option value="series" {% if request.GET.type == "series" %}selected{% endif %}>Series</option>
                <option value="documentary" {% if request.GET.type == "documentary" %}selected{% endif %}>Documentary</option>
            </select>
        </div>
        <button type="submit" class="btn btn-secondary">Search</button>
        {% if request.GET.q or request.GET.category or request.GET.type %}
        <a href="{% url 'netflix:admin_video_list' %}" class="btn btn-secondary">Clear</a>
        {% endif %}
    </form>
</div>

<!-- Videos Table -->
<div class="admin-card">
    <h2 class="admin-card-title">Videos ({{ videos|length }})</h2>
    {% if videos %}
    <table class="admin-table">
        <thead>
            <tr>
                <th style="width: 80px;">Thumbnail</th>
                <th>Title</th>
                <th>Type</th>
                <th>Year</th>
                <th>Rating</th>
                <th>Views</th>
                <th>Status</th>
                <th style="width: 150px;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for video in videos %}
            <tr>
                <td>
                    <img src="{{ video.thumbnail }}" class="table-thumbnail" alt="{{ video.title }}">
                </td>
                <td>
                    <strong>{{ video.title }}</strong>
                    {% if video.is_featured %}
                    <span style="background: #E50914; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px; margin-left: 8px;">FEATURED</span>
                    {% endif %}
                </td>
                <td>{{ video.get_video_type_display }}</td>
                <td>{{ video.year }}</td>
                <td>
                    <span style="{% if video.rating_percentage >= 80 %}color: #46d369{% elif video.rating_percentage >= 50 %}color: #ffa500{% else %}color: #e87c03{% endif %}; font-weight: bold;">
                        {{ video.rating_percentage }}%
                    </span>
                </td>
                <td>{{ video.view_count }}</td>
                <td>
                    {% if video.is_active %}
                    <span style="color: #46d369;">‚óè Active</span>
                    {% else %}
                    <span style="color: #8c8c8c;">‚óè Inactive</span>
                    {% endif %}
                </td>
                <td>
                    <div class="table-actions">
                        <a href="{% url 'netflix:admin_video_edit' video.id %}" class="btn-action" title="Edit">
                            ‚úèÔ∏è
                        </a>
                        <a href="{% url 'netflix:admin_video_delete' video.id %}" 
                           class="btn-action" 
                           onclick="return confirm('Are you sure you want to delete {{ video.title }}?');"
                           title="Delete">
                            üóëÔ∏è
                        </a>
                        <a href="{% url 'netflix:player' video.id %}" 
                           target="_blank" 
                           class="btn-action" 
                           title="View on Site">
                            üëÅÔ∏è
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #8c8c8c; text-align: center; padding: 40px 0;">
        {% if request.GET.q or request.GET.category or request.GET.type %}
        No videos found matching your search criteria.
        {% else %}
        No videos yet. Click "Add New Video" to create your first video!
        {% endif %}
    </p>
    {% endif %}
</div>
{% endblock %}

{% block extra_css %}
<style>
    .table-actions {
        display: flex;
        gap: 8px;
        justify-content: center;
    }
    .btn-action {
        font-size: 18px;
        cursor: pointer;
        padding: 4px 8px;
        border-radius: 4px;
        transition: background 0.2s;
        text-decoration: none;
    }
    .btn-action:hover {
        background: rgba(229, 9, 20, 0.1);
    }
</style>
{% endblock %}
